FROM node:14-alpine
# ARG
ARG PORT
ARG DATABASE
ARG SECRET
ARG TOKEN_DURATION
ARG GITHUB_SECRET
ARG GITHUB_CLIENT_ID
ARG GITHUB_CALLBACK_URL
# ENV
ENV PORT=${PORT}
ENV DATABASE=${DATABASE}
ENV SECRET=${SECRET}
ENV TOKEN_DURATION=${TOKEN_DURATION}
ENV GITHUB_SECRET=${GITHUB_SECRET}
ENV GITHUB_CLIENT_ID=${GITHUB_CLIENT_ID}
ENV GITHUB_CALLBACK_URL=${GITHUB_CALLBACK_URL}
# TEST
RUN node --version
# REAL WORK
WORKDIR /usr/src/app
COPY package.json .
RUN npm install
RUN npm install -g pm2
ADD . /usr/src/app
RUN npm run build
CMD ["npm","run","start:prod"]
EXPOSE ${PORT}
